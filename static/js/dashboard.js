(function(a){var e=function(d,e){a.each(e,function(a,e){d=d.replace(RegExp("{{ *"+a+" *}}"),e)});return d};a(function(){var d=a("#zem_rp_statistics_wrap"),y=a("#zem_rp_dashboard_url").val(),s=a("#zem_rp_blog_id").val(),t=a("#zem_rp_zemanta_username").val(),z=a("#zem_rp_auth_key").val(),g=a("#zem_rp_ajax_nonce").val(),A=0<a("#zem_rp_show_traffic_exchange_statistics").length,u=null,n=null,k=!1,p=null,b=null,f,h,i,l,q,w=function(a){a||(a=2E3);clearInterval(n);0<a&&(n=setInterval(r,a))},x=function(b){var c=
a("#zem_rp_statistics_wrap");b||c.find(".unavailable").slideDown();w(3E4);k=!1},r=function(v){k||(k=!0,u=setTimeout(function(){x(!v)},2E3),a.getJSON(y+"pageviews/?callback=?",{blog_id:s,auth_key:z},function(c){var j=c.data;clearTimeout(u);if(!c||"ok"!==c.status||!c.data)x(!v);else{b||(b=a('<ul class="statistics" />'),d.find(".unavailable").slideUp(),b.append('<li class="title"><div class="desktop">Desktop</div><div class="mobile">Mobile</div></li>'),b.append(e('<li class="{{class}} stats"><p class="num mobile"></p><p class="num all"></p><h5>{{ title}}<span>{{range}}</span></h5></li>',
{"class":"ctr",title:"click-through rate",range:"last 30 days"})),b.append(e('<li class="{{class}} stats"><p class="num mobile"></p><p class="num all"></p><h5>{{ title}}<span>{{range}}</span></h5></li>',{"class":"pageviews",title:"page views",range:"last 30 days"})),b.append(e('<li class="{{class}} stats"><p class="num mobile"></p><p class="num all"></p><h5>{{ title}}<span>{{range}}</span></h5></li>',{"class":"clicks",title:"clicks",range:"last 30 days"})),d.append(b),A&&d.append('<div class="network"><div class="icon"></div><span class="num"></span><h4>Inbound Visitors</h4><div class="description"><p>Number of visitors that came to your site because this plugin promoted your content on other sites.<strong>Wow, a traffic exchange! :)</strong></p></div></div>'));
w(c.data.update_interval);f=Math.max(j.mobile_pageviews,f||0);h=Math.max(j.mobile_clicks,h||0);c=0<f&&(100*(h/f)).toFixed(1)||0;i=Math.max(j.pageviews-f,i||0);l=Math.max(j.clicks-h,l||0);var g=0<i&&(100*(l/i)).toFixed(1)||0;q=Math.max(j.network_in_pageviews,q||0);b.find(".ctr .num.all").html(g+"%");b.find(".pageviews .num.all").html(i);b.find(".clicks .num.all").html(l);b.find(".ctr .num.mobile").html(c+"%");b.find(".pageviews .num.mobile").html(f);b.find(".clicks .num.mobile").html(h);d.find(".network .num").html(q);
k=!1}}))},m=function(){jQuery.post(ajaxurl,{action:"zem_rp_is_zemanta_connected",_wpnonce:g},function(a){"yes"===a&&(clearInterval(p),window.location.reload())})};a("#zem-rp-login").click(function(){p=setInterval(m,4E3);setTimeout(m,300)});!t&&document.location.hash.match(/turn-on-rp/)&&(document.location.hash="",p=setInterval(m,4E3),setTimeout(m,300));t&&s&&(r(!0),n=setInterval(r,2E3));a(".zem_rp_notification .close").on("click",function(b){a.ajax({url:a(this).attr("href"),data:{noredirect:!0,_wpnonce:g}});
a(this).parent().slideUp(function(){a(this).remove()});b.preventDefault()});a("#zem_rp_wrap .collapsible .collapse-handle").on("click",function(b){var c=a(this).closest(".collapsible"),d=c.find(".container"),e=c.hasClass("collapsed"),f=c.attr("block");e?(d.slideDown(),a.post(ajaxurl,{action:"rp_show_hide_"+f,show:!0,_wpnonce:g})):(d.slideUp(),a.post(ajaxurl,{action:"rp_show_hide_"+f,hide:!0,_wpnonce:g}));c.toggleClass("collapsed");b.preventDefault()})})})(jQuery);
